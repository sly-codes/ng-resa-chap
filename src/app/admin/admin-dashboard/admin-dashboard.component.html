<div class="admin-dashboard" *ngIf="dashboardState$ | async as state">
  
  <!-- En-tête -->
  <div class="dashboard-header">
    <div class="header-content">
      <h1 class="dashboard-title">
        <i class='bx bx-bar-chart-alt-2'></i>
        <span>Tableau de Bord Administration</span>
      </h1>
      <span class="admin-badge">
        <i class='bx bx-shield-quarter'></i>
        Super Admin
      </span>
    </div>
  </div>

  <!-- Loader -->
  <div *ngIf="state.loading" class="dashboard-loader">
    <i class='bx bx-loader-alt bx-spin'></i>
    <p>Chargement des statistiques...</p>
  </div>

  <!-- Erreur -->
  <div *ngIf="state.error" class="alert alert-error">
    <i class='bx bx-error-circle'></i>
    <span>Erreur lors du chargement des métriques. Vérifiez les logs du backend ou les permissions.</span>
  </div>

  <!-- Contenu du Dashboard -->
  <div *ngIf="state.metrics && !state.loading" class="dashboard-content">

    <!-- Cards de statistiques principales -->
    <div class="stats-grid">
      
      <!-- Utilisateurs -->
      <div class="stat-card stat-primary">
        <div class="stat-icon">
          <i class='bx bx-user'></i>
        </div>
        <div class="stat-content">
          <h3 class="stat-label">Utilisateurs Totaux</h3>
          <div class="stat-value">{{ state.metrics.users.total | number }}</div>
          <div class="stat-details">
            <i class='bx bx-check-circle'></i>
            <span>{{ state.metrics.users.verified | number }} vérifiés</span>
          </div>
        </div>
      </div>
      
      <!-- Ressources -->
      <div class="stat-card stat-warning">
        <div class="stat-icon">
          <i class='bx bx-sitemap'></i>
        </div>
        <div class="stat-content">
          <h3 class="stat-label">Ressources Actives</h3>
          <div class="stat-value">{{ state.metrics.resources.total | number }}</div>
          <div class="stat-details">
            <i class='bx bx-trending-up'></i>
            <span>{{ state.metrics.resources.recentLastWeek | number }} cette semaine</span>
          </div>
        </div>
      </div>
      
      <!-- Réservations -->
      <div class="stat-card stat-info">
        <div class="stat-icon">
          <i class='bx bx-calendar-check'></i>
        </div>
        <div class="stat-content">
          <h3 class="stat-label">Réservations</h3>
          <div class="stat-value">{{ state.metrics.reservations.total | number }}</div>
          <div class="stat-details">
            <i class='bx bx-time-five'></i>
            <span>{{ state.metrics.reservations.pending | number }} en attente</span>
          </div>
        </div>
      </div>

      <!-- Revenus -->
      <div class="stat-card stat-success">
        <div class="stat-icon">
          <i class='bx bx-euro'></i>
        </div>
        <div class="stat-content">
          <h3 class="stat-label">Revenu Potentiel</h3>
          <div class="stat-value">{{ formatCurrency(state.metrics.finance.potentialRevenueFromConfirmedReservations) }}</div>
          <div class="stat-details">
            <i class='bx bx-info-circle'></i>
            <span>Réservations confirmées</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Sections détaillées -->
    <div class="details-grid">
      
      <!-- Utilisateurs récents -->
      <div class="detail-card">
        <div class="card-header">
          <div class="header-left">
            <i class='bx bx-user-plus'></i>
            <h2>Derniers Utilisateurs</h2>
          </div>
          <span class="header-count">{{ state.metrics.users.recent.length }}</span>
        </div>
        <div class="card-body">
          <div class="user-list">
            <div class="user-item" *ngFor="let user of state.metrics.users.recent">
              <div class="user-info">
                <div class="user-avatar">
                  <i class='bx bx-user-circle'></i>
                </div>
                <div class="user-details">
                  <span class="user-email">{{ user.email }}</span>
                  <span class="user-date">
                    <i class='bx bx-calendar'></i>
                    {{ user.createdAt | date:'dd/MM/yyyy' }}
                  </span>
                </div>
              </div>
              <span class="user-provider" [class.provider-local]="user.provider === 'LOCAL'" [class.provider-google]="user.provider === 'GOOGLE'">
                {{ user.provider === 'LOCAL' ? 'Email' : 'Google' }}
              </span>
            </div>
            <div class="empty-state" *ngIf="state.metrics.users.recent.length === 0">
              <i class='bx bx-info-circle'></i>
              <p>Aucun utilisateur récent</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Réservations récentes -->
      <div class="detail-card">
        <div class="card-header">
          <div class="header-left">
            <i class='bx bx-list-ul'></i>
            <h2>Dernières Réservations</h2>
          </div>
          <span class="header-count">{{ state.metrics.reservations.recent.length }}</span>
        </div>
        <div class="card-body">
          <div class="reservation-list">
            <div class="reservation-item" *ngFor="let res of state.metrics.reservations.recent">
              <div class="reservation-info">
                <span class="reservation-resource">{{ res.resourceName }}</span>
                <span class="reservation-user">
                  <i class='bx bx-user'></i>
                  {{ res.locataireEmail }}
                </span>
              </div>
              <div class="reservation-meta">
                <span class="reservation-status" 
                      [class.status-pending]="res.status === 'PENDING'"
                      [class.status-confirmed]="res.status === 'CONFIRMED'"
                      [class.status-cancelled]="res.status === 'CANCELLED'">
                  {{ getStatusLabel(res.status) }}
                </span>
                <span class="reservation-price">{{ res.resourcePrice | currency:'XOF' }}</span>
              </div>
            </div>
            <div class="empty-state" *ngIf="state.metrics.reservations.recent.length === 0">
              <i class='bx bx-info-circle'></i>
              <p>Aucune réservation récente</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Répartition des ressources -->
    <div class="resources-section">
      <div class="detail-card">
        <div class="card-header">
          <div class="header-left">
            <i class='bx bx-pie-chart-alt-2'></i>
            <h2>Répartition des Ressources</h2>
          </div>
        </div>
        <div class="card-body">
          <div class="resource-types-grid">
            <div class="resource-type-card" *ngFor="let type of state.metrics.resources.typesCount">
              <div class="type-icon" [class.type-room]="type.type === 'ROOM'" [class.type-equipment]="type.type === 'EQUIPMENT'">
                <i class='bx' [ngClass]="type.type === 'ROOM' ? 'bx-buildings' : 'bx-devices'"></i>
              </div>
              <div class="type-info">
                <span class="type-count">{{ type.count }}</span>
                <span class="type-label">{{ getResourceTypeLabel(type.type) }}</span>
              </div>
            </div>
            <div class="empty-state" *ngIf="state.metrics.resources.typesCount.length === 0">
              <i class='bx bx-info-circle'></i>
              <p>Aucune ressource disponible</p>
            </div>
          </div>
        </div>
      </div>
    </div>

  </div>
</div>