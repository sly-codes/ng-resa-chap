<div class="resources-container">
  <div class="resources-header">
    <h1>
      <span>Mes Ressources</span>
      <i class="bx bx-sitemap"></i>
    </h1>
    <button (click)="onAddResource()" class="btn-add-resource">
      <i class="bx bx-plus-circle"></i>
      <span>Ajouter une ressource</span>
    </button>
  </div>

  <div class="resources-controls">
    <div class="filter-controls-group">
      <div class="control-group">
        <label for="type-filter">Type</label>
        <select id="type-filter" [formControl]="typeFilter">
          <option value="ALL">Tous les types</option>
          <option value="ROOM">Salle</option>
          <option value="EQUIPMENT">Équipement</option>
        </select>
      </div>

      <div class="control-group search-control">
        <i class="bx bx-search"></i>
        <input
          type="text"
          [formControl]="searchControl"
          placeholder="Rechercher par nom..."
          aria-label="Rechercher par nom"
        />
      </div>
    </div>

    <button
      class="btn-refresh"
      (click)="onRefresh()"
      [disabled]="loading"
      title="Rafraîchir la liste"
      aria-label="Rafraîchir la liste"
    >
      <i class="bx" [ngClass]="{ 'bx-loader-alt bx-spin': loading, 'bx-refresh': !loading }"></i>
      <span class="btn-text">Actualiser</span>
    </button>
  </div>

  <div *ngIf="error" class="resources-error">
    {{ error }}
  </div>

  <div *ngIf="loading" class="resources-loader">
    <i class="bx bx-loader-alt bx-spin"></i>
  </div>

  <ng-container *ngIf="resources$ | async as resources">
    <div *ngIf="resources.length === 0 && !loading && !error" class="resources-empty">
      <i class="bx bx-info-circle"></i>
      <p>
        Aucune ressource trouvée avec les critères actuels.<br />
        Cliquez sur "Ajouter une ressource" pour commencer.
      </p>
    </div>

    <div *ngIf="resources.length > 0 && !loading" class="resources-table-wrapper">
      <table class="resources-table">
        <thead>
          <tr>
            <th scope="col">Nom</th>
            <th scope="col">Type</th>
            <th scope="col" class="d-none d-md-table-cell">Description</th>
            <th scope="col">
              <span>Actions</span>
            </th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let resource of resources">
            <td class="resource-name">
              {{ resource.name }}
            </td>

            <td>
              <span
                class="resource-type-badge"
                [ngClass]="{
                  'badge-room': resource.type === 'ROOM',
                  'badge-equipment': resource.type === 'EQUIPMENT'
                }"
              >
                <i [class]="'bx ' + getResourceIcon(resource.type)"></i>
                <span>{{ resource.type }}</span>
              </span>
            </td>

            <td class="resource-description d-none d-md-table-cell">
              {{ resource.description || 'Aucune description' }}
            </td>

            <td class="actions-cell">
              <div
                ngbDropdown
                container="body"
                placement="bottom-end"
                class="resource-actions-dropdown"
              >
                <button
                  type="button"
                  class="btn-actions"
                  ngbDropdownToggle
                  [disabled]="resource.isDeleting"
                  [attr.aria-label]="'Actions pour ' + resource.name"
                >
                  <i
                    class="bx"
                    [ngClass]="{
                      'bx-loader-alt bx-spin': resource.isDeleting,
                      'bx-dots-vertical-rounded': !resource.isDeleting
                    }"
                  ></i>
                </button>
                <div ngbDropdownMenu class="actions-menu">
                  <button
                    ngbDropdownItem
                    (click)="onEdit(resource.id)"
                    class="action-item action-edit"
                  >
                    <i class="bx bx-edit"></i>
                    <span>Modifier</span>
                  </button>
                  <button
                    ngbDropdownItem
                    (click)="onDeleteRequest(resource)"
                    class="action-item action-delete"
                  >
                    <i class="bx bx-trash"></i>
                    <span>Supprimer</span>
                  </button>
                </div>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </ng-container>
</div>
